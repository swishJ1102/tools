import os
import openpyxl

def find_called_files(folder_path, file_name, depth):
    called_files = []
    for file in os.listdir(folder_path):
        if file.endswith('.xlsx'):
            file_path = os.path.join(folder_path, file)
            wb = openpyxl.load_workbook(file_path)
            ws = wb.active
            if file_name in ws:
                called_files.append((file_name, depth))
                for row in ws.iter_rows(values_only=True):
                    for cell in row:
                        if cell != file_name:
                            called_files += find_called_files(folder_path, cell, depth + 1)
            wb.close()
    return called_files

def main():
    z_folder = 'path/to/z/folder'
    output = []
    for file in os.listdir(z_folder):
        if file.endswith('.xlsx'):
            called_files = find_called_files(z_folder, file.split('.')[0], 1)
            for files in called_files:
                output.append(' '.join(['\t'] * (files[1] - 1) + [files[0]]))
    with open('output.txt', 'w') as f:
        f.write('\n'.join(output))

if __name__ == "__main__":
    main()